<!DOCTYPE html>
<html>
<head>
	<title>Your Pantry</title>
</head>
<body>
	<h1>Hey, <%= @user.name %> </h1>
	<p>Here are your current foods:</p>	
	
	<div class="my-foods">
		<ul class="food-list">
		<% @foods.each do |food| %>
			<li data-id="<%= food.id %>">

				<h4><%= food.food_name %></h4>
				<p><%= food.quantity %></p>
				<p><%= food.expiration %></p>
				
			
				<button class="edit-button">Edit Me</button>
				<button class="delete-button">Delete Me</button>
			</li>
		<% end %>
		</ul>

	</div>
	
	<%= form_for [@user, @food], :html => { :id => "new-food-form" } do |f| %>
		<%= f.label :food_name %>
		<%= f.text_field :food_name %>
		<%= f.label :quantity %>
		<%= f.text_field :quantity %>
		<%= f.label :expiration %>
		<%= f.text_field :expiration %>
		<%= f.submit "Add New Food!" %>

	<% end %>

	<script type="text/javascript">

		$(document).on("click", ".delete-button", function(){
			var element = $(this);
			console.log(element.parent().data("id"));
			var foodId = element.parent().data("id");

			$.ajax({
				url: "/users/<%= @user.id %>/foods/" + foodId,
				type: "DELETE",
				success: function(e){
					element.parent().remove();
				}
			})
		});
			
		

		var form = $("#new-food-form");
		form.submit(function(e){
			$.ajax({
				url: "<%= user_foods_path(@user) %>",
				method: "POST",
				data: form.serialize(),
				success: function(data) {
					console.log(data.food_name);
					$(".food-list").append("<li data-id=" + data.id + "><h4>" + data.food_name + "</h4>" + "<p>" + data.quantity + "</p> <p>" + data.expiration + "</p><button class='edit-button'>Edit Me</button> <button class='delete-button'>Delete Me</button></li>")
				}
			});
			e.preventDefault();
		});
		
	</script>


	



</body>
</html>

